# 三国杀卡牌游戏开发文档

---

### ThreeKill 1.1.0

---

**_上一个版本(1.0.1)存在的问题：_**  

1. 没有死亡机制, 血量甚至出现负数
2. 出牌逻辑急需优化, 当前版本 "桃" 全喂给别人了
3. 目标总是指向下一个, 无法选择
4. 只有 "杀" 和 "桃", 没有其他牌,缺乏变化
5. 牌堆的牌使用一次就作废,没有循环利用
6. 摸一张牌出一张牌,没有利用手牌的设定

---
**_在 1.0.1 的基础上，做出以下更新；_**
> + **引入死亡机制**
>   + _血量为 0 时, 进入 "濒死" 状态, 需要使用 "桃" 或 "酒" 才能救回_
>   + _濒死状态下, 不能出牌, 只能等待救援_
>   + _如果没有救回, 则出局_
>   + _当仅有一人存活时，该玩家胜利_
>     + `在 Player类 中新增 isDanger 属性 , 用于标记濒死状态`
>     + `在 Player类 中新增 isAlive 属性 , 用于标记存活状态`
>     + `新增 rescue() 方法，用于救援濒死玩家`
>     + `更新 loseHealth() ,当 health 降至 0 时，设置 isDying = true`
>     + `新增 setDanger() 方法，用于设置濒死状态`

> + **引入目标选择逻辑**  
>   + _优先选择手牌最少的玩家_
>   + _如果有多个手牌最少的玩家, 则选择第一个_
>     + `在 Player类 中新增 chooseTarget() 方法，用于选择目标玩家`
>     + `更新 playCard() 方法，使用 chooseTarget() 选择目标`

> + **新增 "酒" 和 "闪"**  
>   + _酒: 下一张 "杀" 伤害 +1_
>   + _闪: 可以抵消一张 "杀"_
>     + `更新 use() 方法，实现 "酒" 和 "闪" 的效果`
>     + `在 Player类 中新增 isDrunk 属性 , 用于标记醉酒状态`
>     + `在 Player类 中更新 heal() 方法，处理 "酒" 的效果`
>     + `在 Player类 中新增 dodge() 方法，处理 "闪" 的效果`
>     + `在 Player类 中更新 playCard() 方法，处理 "酒" 的使用逻辑`

> + **优化出牌逻辑**
>   + _优先使用 "杀" 攻击其他玩家_
>   + _可以出多张牌_
>   + _"桃" 和 "酒" 优先治疗自己，但不能超过体力上限_
>   + _"闪" 不能直接使用, 只能响应 "杀"_
>   + _如果没有可用牌, 则跳过回合到下一个玩家_

> + **优化摸牌逻辑**
>   + _游戏开始时, 每个玩家发4张牌_ 
>   + _每回合开始时, 摸两张牌, 然后出牌_
>     + `在 Game类 中的 gameStart() 方法，发4张牌给每个玩家`
>     + `在 Game类 中的游戏循环逻辑，调整为每回合开始时摸2张牌`

> + **增加弃牌阶段**
>   + _每回合结束时, 如果手牌多于当前体力值, 则将多余的手牌丢弃_
>     + `在 Player类 中新增 discard() 方法，用于弃牌`

> + **牌堆循环利用, 新增弃牌堆** 
>  + _所有打出的牌和丢弃的牌都进入弃牌堆_
>  + _当摸牌堆为空时, 将弃牌堆洗牌后重新作为摸牌堆_
>    + `在 Deck类 中新增 discardPile 属性 , 用于存放弃牌堆`
>    + `在 Deck类 中新增 reshuffle() 方法 , 用于将弃牌堆洗牌后重新作为摸牌堆`
>    + `在 deal() 方法中，检查摸牌堆是否为空, 如果为空则调用 reshuffle()`
>    + `在 Player类 的 playCard() 和 discard() 方法中，将打出的牌和弃掉的牌加入弃牌堆`

---
**_当前版本_**
1. 四人游戏，轮流按规则出牌
2. 有摸牌阶段、出牌阶段、弃牌阶段
3. 优先使用 "杀" 攻击，优先用 "桃" 和 "酒" 治疗自己
4. 有死亡机制，血量为0时进入濒死状态
5. 牌堆循环利用，有弃牌堆
6. 目标选择手牌最少的玩家
7. 在控制台输出，不做前端
8. 所有文件放在一起，先不考虑项目结构

---

### 需要的 Class  
**玩家**、**卡牌** 是最基本的两个类，此外，需要一个管理卡牌的 **牌堆**，
和一个管理游戏进程的 **游戏类**

---

***Player: 玩家类***
- **field：**
  - | 属性        | 类型        | 描述    |
    |-----------|-----------|-------|
    | name      | `String`  | 玩家名称  |
    | handCard  | `List`    | 手牌    |
    | health    | `Int`     | 体力/血量 |
    | maxHealth | `Int`     | 最大体力  |
    | isDanger  | `Boolean` | 濒死状态  |
    | isAlive   | `Boolean` | 是否存活  |
    | isDrunk   | `Boolean` | 醉酒状态  |

  
- **method:**
  - | 方法                 | 描述       | 
    |--------------------|----------|
    | drawCard           | 摸牌       | 
    | playCar()          | 出牌       |
    | loseHealth()       | 掉血       |
    | heal()             | 回血       |
    | setDangerState()   | 设置濒死状态   |
    | resetDangerState() | 脱离濒死状态   |
    | rescue()           | 救援濒死玩家   |
    | discard()          | 弃牌       |
    | chooseTarget()     | 选择目标     |

---

***Card: 卡牌类***
- **field：**
  - | 属性        | 类型        | 描述 |
    |-----------|-----------|----|
    | name      | `String`  | 牌名 |



- **method:**
  - | 方法                 | 描述     | 
    |--------------------|--------|
    | use()              | 使用/效果  | 


---

***Deck: 牌堆类***
- **field：**
  - | 属性          | 类型     | 描述  |
        |-------------|--------|-----|
    | drawPile    | `List` | 摸牌堆 |
    | disCardPile | `List` | 弃牌堆 |


- **method:**
  - | 方法          | 描述    | 
        |-------------|-------|
    | addCrd()    | 为牌堆加牌 | 
    | deal()      | 发牌    |
    | reshuffle() | 洗牌    |

---

***Game: 游戏类***
- **field：**
  - | 属性      | 类型     | 描述  |
    |---------|--------|-----|
    | players | `List` | 玩家表 |
    | deck    | `Deck` | 牌堆  |


- **method:**
  - | 方法          | 描述     | 
    |-------------|--------|
    | gameStart() | 游戏运行逻辑 | 
  
---
