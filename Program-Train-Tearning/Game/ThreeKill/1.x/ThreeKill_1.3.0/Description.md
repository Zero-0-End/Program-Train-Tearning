# 三国杀卡牌游戏开发文档

---

### ThreeKill 1.3.0

---

**_上一个版本(1.2.0)存在的问题：_**  

1. Turn 十分混乱, 既是回合控制,又负责了具体的酒杀以及回血规则，已经不清楚它到底是干什么的了
2. 弃牌方式过于简单,只是remove(0),没有考虑具体策略
3. 部分方法的定义有问题;JiuCard.use()中只打印醉酒,没有调用setDrunk;
4. 所有文件放在一起，有点混乱
5. 缺乏身份系统,技能系统,且卡牌只有基本牌

---
**_在 1.2.0 的基础上，做出以下更新；_**
> + **增加规则引擎 RuleEngine**
>   + _Turn 只负责回合控制_
>     + `定义阶段: 摸牌阶段、出牌阶段、响应阶段、弃牌阶段`
>     + `调用规则引擎:将每阶段的具体逻辑交给规则引擎处理`
>     + `回合结束后由Game接管,到下一个玩家再由Turn处理`
>   + _新增规则引擎 RuleEngine 类_ 
>     +  `RuleEngine 没有成员变量, 只有方法, 也就是只处理规则不保存数据`
>     + ``处理游戏规则: 杀的响应结算规则、濒死救援的规则、胜利规则``
>     + `处理玩家策略逻辑: 出牌策略、目标选择策略、弃牌策略`

> + **优化弃牌逻辑**
>  + _优先弃掉重复的杀_
>  + _没有重复的杀,弃掉重复的酒和桃_
>  + _没有重复牌,优先保留酒和桃
>  + _其他情况 remove(0)_

> + **新增身份系统 Identity**  
>   + _新增 枚举类 Identity, 包括 主公,忠臣,反贼,内奸_
>   + _在 Player 中添加 identity 属性_
>   + _在 Game 中根据身份分配规则分配身份_
>   + _在 Rule 中添加胜利条件判断_


> + **优化方法, 进一步解耦, 并进行简单的分包**
>   + _将Card 和子类放进 ThreeKill.Card 包_
>   + _移除 Card 的 use() 的逻辑,只负责描述功能, 将卡牌使用规则交给 RuleEngine_
>   + _Player只负责出牌、弃牌等动作，不负责出牌、弃牌等策略,减少与其他类的交互；其他同理_
>   + _将更多的类之间的交互工作交给 RuleEngine 处理_

---
**_当前版本_**
1. 四人身份场,一主公,一忠臣,一内奸,一反贼；根据胜利条件决定出牌策略
2. Game 游戏开始, 获取玩家列表，初始化牌堆、初始化玩家手牌
3. Turn 控制当前回合流程，回合开始、牌堆发牌、玩家摸牌、玩家出牌、弃牌、回合结束等
4. Turn调用RuleEngine 处理出牌过程中的具体逻辑判定，比如 如何响应杀、濒死救援规则、出牌策略、弃牌策略、目标选择策略
5. 每回合结束 Turn 调用 RuleEngine 进行胜利条件判断，如果达成胜利条件，由Game结束游戏
6. 不做前端，在控制台输出；只有杀闪酒桃，没有装备，没有武将技能

---

### 需要的 Class  
  | **Class**  |           **功能**            |
  |:----------:|:---------------------------:|
  |   Player   |          定义玩家和玩家行为          |   
  |    Card    |          定义卡牌和卡牌功能          |    
  |    Deck    |            管理牌堆             |   
  |  Identity  |            身份枚举             |   
  | RuleEngine |        定义卡牌使用规则和效果结算        |   
  |    Turn    |       局部管理：控制当前回合的流程        |   
  |    Game    | 全局管理：管理牌堆和玩家列表、启动或结束游戏、统计结果 |   


---

***Player: 玩家类***
- **field：**
  - | 属性        | 类型          | 描述     |
    |-----------|-------------|--------|
    | name      | `String`    | 玩家名称   |
    | handCard  | `List`      | 手牌     |
    | health    | `Int`       | 体力/血量  |
    | maxHealth | `Int`       | 最大体力   |
    | isDanger  | `Boolean`   | 濒死状态   |
    | isAlive   | `Boolean`   | 是否存活   |
    | isDrunk   | `Boolean`   | 醉酒状态   |
  - | identity  | `Identity`  | 玩家身份   |

  
- **method:**
  - | 方法                  | 描述       | 
    |---------------------|----------|
    | drawCard            | 摸牌       | 
    | playCar()           | 出牌       |
    | discardCard()       | 弃牌       |
    | loseHealth()        | 掉血       |
    | heal()              | 回血       |
    | setDangerState()    | 设置濒死状态   |
    | resetDangerState()  | 脱离濒死状态   |
    | rescue()            | 救援濒死玩家   |
    | discard()           | 弃牌       |
    | chooseTarget()      | 选择目标     |
    | findCardByName()    | 根据牌名检索手牌 |

---

***Card: 卡牌抽象类***
- **field：**
  - | 属性        | 类型        | 描述 |
    |-----------|-----------|----|
    | name      | `String`  | 牌名 |



- **method:**
  - | 方法         | 描述   | 
    |------------|------|
  - | use()      | 效果描述 |


- **继承的类**
  - **ShaCard**
  - **JiuCard**
  - **TaoCard**
  - **ShanCard**

---

***Deck: 牌堆类***
- **field：**
  - | 属性          | 类型     | 描述  |
        |-------------|--------|-----|
    | drawPile    | `List` | 摸牌堆 |
    | disCardPile | `List` | 弃牌堆 |


- **method:**
  - | 方法          | 描述    | 
        |-------------|-------|
    | addCrd()    | 为牌堆加牌 | 
    | deal()      | 发牌    |
    | reshuffle() | 洗牌    |

---

***Game: 游戏类***
- **field：**
  - | 属性      | 类型     | 描述   |
    |---------|--------|------|
    | players | `List` | 玩家表  |
    | deck    | `Deck` | 牌堆   |
  - | rule    | `Rule` | 规则引擎 |


- **method:**
  - | 方法                   | 描述      | 
    |----------------------|---------|
    | gameStart()          | 游戏运行逻辑  |
  - | countHealth()        | 统计血量    |
  - | getIdentityPlayers() | 获取各势力角色 |
  - | initializeDeck()     | 初始化牌堆   |
  
---

***Turn: 回合类***
- **field：**
    - | 属性   | 类型   | 描述   |
      |------|------|------|
      | game | `Game` | 所属游戏 |
   


- **method:**
    - | 方法             | 描述   | 
      |----------------|------|
      | start()        | 回合开始 |
    - | drawPhase()    | 摸牌阶段 |
    - | playPhase()    | 出牌阶段 |
    - | disCardPhase() | 弃牌阶段 |
    - | endPhase()     | 回合结束 |

---

***RuleEngine: 规则引擎***
- **field：**
    - | 属性     | 类型     | 描述  |
      |--------|--------|-----|


- **method:**
    - | 方法                  | 描述     | 
      |---------------------|--------|
      | gameStart()         | 游戏运行逻辑 | 
    - | shaCardSettlement() | 杀的响应逻辑 |
    - | dangerSettlement()  | 濒死救援逻辑 |
    - | isGameOver()        | 游戏结束判定 |

---