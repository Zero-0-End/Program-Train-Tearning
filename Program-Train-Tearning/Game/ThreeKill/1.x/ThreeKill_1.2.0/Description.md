# 三国杀卡牌游戏开发文档

---

### ThreeKill 1.2.0

---

**_上一个版本(1.1.0)存在的问题：_**  

1. 回血超过体力上限
2. 出牌逻辑仍然有问题, 总是空喝酒, 多次出杀
3. 非濒死状态喝酒回血，救援时只能自救
4. 输出太乱，控制台看得眼花
5. 游戏逻辑混乱,游戏回合与玩家伦次重叠
6. 代码冗余，缺少复用,耦合严重,结构不清晰很乱

---
**_在 1.1.0 的基础上，做出以下更新；_**
> + **限制回血上限**
>   + _不能超过体力上限_
>   + _体力满了不使用桃_

> + **优化 "酒" 牌逻辑**  
>   + _当手上无杀时,除非自救,否则不喝酒_
>   + _酒只有在濒死状态可以回血,且濒死状态喝酒不进入醉酒状态_

> + **优化救援逻辑**
>  + _优先向其他玩家求援, 无人救援则自救_
>  + _其他玩家根据设置的概率决定是否救援_
>  + _酒只能自救，桃既可以自救也可以救援别人_
>    + `Player中设计 自救、响应、求援 方法`
>    + `求援是找别人要牌, 响应是给出相应的牌`


> + **游戏逻辑调整**
>   + _玩家从准备到结束是一个回合_
>   + _所有玩家都完成自己的一个回合,称为一个轮次_
>   + _每个玩家的回合内包含摸牌、出牌、弃牌三个阶段_
>   + _每个玩家每回合只能出一次杀_

> + **优化打印结果**  
>   + _发牌阶段,统计各种牌数量_
>   + _玩家行动结束,统计血量和手牌数量_
>   + _不同玩家的回合之间做分隔_

> + **优化代码结构**
>   + _新增一个类 Turn, 用于管理回合阶段与切换玩家_
>   + _优化 Player 类中的方法, 减少冗余代码_
>   + _将Card抽象,杀闪酒桃作为类继承并重写use()_
>     + `Game 负责整个游戏流程：初始化玩家、回合循环、结果统计、胜利判定`
>     + `Turn 负责更细节的回合逻辑：从牌堆摸牌、弃牌进入弃牌堆 等`
>     + `Player 负责实现玩家功能, 执行 摸牌、出牌、弃牌、响应、检索手牌 等动作；`
>       + `出牌动作和弃牌动作分离，不要将 remove(card) 放在 playCard() 里`
>     + `Deck 管理牌堆和弃牌堆`
>     + `Card 和 子类负责实现卡牌功能`

---
**_当前版本_**
1. 四人游戏，轮流按规则出牌
2. 有摸牌阶段、出牌阶段、弃牌阶段
3. 出牌阶段时，包含等待目标响应的小阶段
4. 优先使用 "杀" 攻击，优先用 "桃" 和 "酒" 治疗自己
5. 有死亡机制，血量为0时进入濒死状态
6. 牌堆循环利用，有弃牌堆
7. 目标选择手牌最少的玩家
8. 在控制台输出，不做前端
9. 所有文件放在一起，先不考虑项目结构

---

### 需要的 Class  
**玩家**、**卡牌** 是最基本的两个类，此外，需要一个管理卡牌的 **牌堆**，
和一个管理游戏进程的 **游戏类**

---

***Player: 玩家类***
- **field：**
  - | 属性        | 类型        | 描述    |
    |-----------|-----------|-------|
    | name      | `String`  | 玩家名称  |
    | handCard  | `List`    | 手牌    |
    | health    | `Int`     | 体力/血量 |
    | maxHealth | `Int`     | 最大体力  |
    | isDanger  | `Boolean` | 濒死状态  |
    | isAlive   | `Boolean` | 是否存活  |
    | isDrunk   | `Boolean` | 醉酒状态  |

  
- **method:**
  - | 方法                  | 描述       | 
    |---------------------|----------|
    | drawCard            | 摸牌       | 
    | playCar()           | 出牌       |
    | discardCard()       | 弃牌       |
    | loseHealth()        | 掉血       |
    | heal()              | 回血       |
    | setDangerState()    | 设置濒死状态   |
    | resetDangerState()  | 脱离濒死状态   |
    | rescue()            | 救援濒死玩家   |
    | discard()           | 弃牌       |
    | chooseTarget()      | 选择目标     |
    | findCardByName()    | 根据牌名检索手牌 |

---

***Card: 卡牌抽象类***
- **field：**
  - | 属性        | 类型        | 描述 |
    |-----------|-----------|----|
    | name      | `String`  | 牌名 |



- **method:**
  - | 方法                 | 描述     | 
    |--------------------|--------|
    | use()              | 使用/效果  | 


- **继承的类**
  - **ShaCard**
    - `重写 use(): 造成伤害`
  - **JiuCard**
    - `重写 use(): 濒死救援或使下次伤害+1`
  - **TaoCard**
    - `重写 use(): 回血`
  - **ShanCard**
    - `重写 use(): 抵消 杀`

---

***Deck: 牌堆类***
- **field：**
  - | 属性          | 类型     | 描述  |
        |-------------|--------|-----|
    | drawPile    | `List` | 摸牌堆 |
    | disCardPile | `List` | 弃牌堆 |


- **method:**
  - | 方法          | 描述    | 
        |-------------|-------|
    | addCrd()    | 为牌堆加牌 | 
    | deal()      | 发牌    |
    | reshuffle() | 洗牌    |

---

***Game: 游戏类***
- **field：**
  - | 属性      | 类型     | 描述  |
    |---------|--------|-----|
    | players | `List` | 玩家表 |
    | deck    | `Deck` | 牌堆  |


- **method:**
  - | 方法          | 描述     | 
    |-------------|--------|
    | gameStart() | 游戏运行逻辑 | 
  
---

***Turn: 回合类***
- **field：**
    - | 属性    | 类型     | 描述  |
      |-------|--------|-----|
     


- **method:**
    - | 方法             | 描述            | 
      |----------------|---------------|
      | executeTurn()  | 回合运行          |
    - | findTarget()   | 为当前玩家寻找目标     |

---